<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.0/jquery.min.js"></script>
</head>
<body>
    <%- include ("navbar.ejs", {one: false, two: false, three: true, foursix: false}) %>
    <div class="container">
        <div class="row">
            <form action="/dice/getquery" method="post">
                <h5 class="mt-3">Dice Query: Get number of reviews grouped by year created, author, author type, the weekday of publication finding specific <strong>author types</strong> and <strong>weekdays</strong></h5>
                <p>
                    Rating behavior of different review author types on specific weekdays<br>
                    Determine if author types have a significance on what day they review to their productivity<br><br>
                    <strong>NOTE:</strong> The second and third fields of each row can be empty if you like.
                </p>
                <p class="mt-2">Author Type(s)</p>
                <div class="row">
                    <div class="col-4">
                        <select name="field1_1" id="field1_1" class="form-control">
                            <option value="blank1" selected>Select Field</option>
                            <option value="assistant editor">Assistant Editor</option>
                            <option value="associate editor">Associate Editor</option>
                            <option value="associate features editor">Associate Features Editor</option>
                            <option value="associate reviews editor">Associate Reviews Editor</option>
                            <option value="associate staff writer">Associate Staff Writer</option>
                            <option value="contributing editor">Contributing Editor</option>
                            <option value="contributor">Contributor</option>
                            <option value="deputy news editor">Deputy News Editor</option>
                            <option value="editor-in-chief">Editor-In-Chief</option>
                            <option value="executive editor">Executive Editor</option>
                            <option value="managing editor">Managing Editor</option>
                            <option value="news director">News Director</option>
                            <option value="senior editor">Senior Editor</option>
                            <option value="senior staff writer">Senior Staff Writer</option>
                            <option value="tracks coordinator">Tracks Coordinator</option>
                        </select>
                    </div>
                    <div class="col-4">
                        <select name="field1_2" id="field1_2" class="form-control">
                            <option value="blank1_1" class="placeholder1" selected>Select Field</option>
                            <option value="assistant editor">Assistant Editor</option>
                            <option value="associate editor">Associate Editor</option>
                            <option value="associate features editor">Associate Features Editor</option>
                            <option value="associate reviews editor">Associate Reviews Editor</option>
                            <option value="associate staff writer">Associate Staff Writer</option>
                            <option value="contributing editor">Contributing Editor</option>
                            <option value="contributor">Contributor</option>
                            <option value="deputy news editor">Deputy News Editor</option>
                            <option value="editor-in-chief">Editor-In-Chief</option>
                            <option value="executive editor">Executive Editor</option>
                            <option value="managing editor">Managing Editor</option>
                            <option value="news director">News Director</option>
                            <option value="senior editor">Senior Editor</option>
                            <option value="senior staff writer">Senior Staff Writer</option>
                            <option value="tracks coordinator">Tracks Coordinator</option>
                        </select>
                    </div>
                    <div class="col-4">
                        <select name="field1_3" id="field1_3" class="form-control">
                            <option value="blank1_2" class="placeholder1" selected>Select Field</option>
                            <option value="assistant editor">Assistant Editor</option>
                            <option value="associate editor">Associate Editor</option>
                            <option value="associate features editor">Associate Features Editor</option>
                            <option value="associate reviews editor">Associate Reviews Editor</option>
                            <option value="associate staff writer">Associate Staff Writer</option>
                            <option value="contributing editor">Contributing Editor</option>
                            <option value="contributor">Contributor</option>
                            <option value="deputy news editor">Deputy News Editor</option>
                            <option value="editor-in-chief">Editor-In-Chief</option>
                            <option value="executive editor">Executive Editor</option>
                            <option value="managing editor">Managing Editor</option>
                            <option value="news director">News Director</option>
                            <option value="senior editor">Senior Editor</option>
                            <option value="senior staff writer">Senior Staff Writer</option>
                            <option value="tracks coordinator">Tracks Coordinator</option>
                        </select>
                    </div>
                </div>
                <p class="mt-4">Weekday(s)</p>
                <div class="row">
                    <div class="col-4">
                        <select name="field2_1" id="field2_1" class="form-control">
                            <option value="blank2" selected>Select Field</option>
                            <option value="0">Monday</option>
                            <option value="1">Tuesday</option>
                            <option value="2">Wednesday</option>
                            <option value="3">Thursday</option>
                            <option value="4">Friday</option>
                            <option value="5">Saturday</option>
                            <option value="6">Sunday</option>
                        </select>
                    </div>
                    <div class="col-4">
                        <select name="field2_2" id="field2_2" class="form-control">
                            <option value="blank2_1" class="placeholder2" selected>Select Field</option>
                            <option value="0">Monday</option>
                            <option value="1">Tuesday</option>
                            <option value="2">Wednesday</option>
                            <option value="3">Thursday</option>
                            <option value="4">Friday</option>
                            <option value="5">Saturday</option>
                            <option value="6">Sunday</option>
                        </select>
                    </div>
                    <div class="col-4">
                        <select name="field2_3" id="field2_3" class="form-control">
                            <option value="blank2_2" class="placeholder2" selected>Select Field</option>
                            <option value="0">Monday</option>
                            <option value="1">Tuesday</option>
                            <option value="2">Wednesday</option>
                            <option value="3">Thursday</option>
                            <option value="4">Friday</option>
                            <option value="5">Saturday</option>
                            <option value="6">Sunday</option>
                        </select>
                    </div>
                </div>
                <br>
                <p id="blank-error" class="text-danger" hidden>The first fields cannot be blank.</p>
                <p id="dupe-error" class="text-danger" hidden>Duplicate fields are not allowed.</p>
                <input id="submit" class="btn btn-primary mr-3" type="submit" value="Search" disabled>
            </form>
        </div>
    </div>
    <% if (result) { %>
    <div class="table-wrapper">
        <table class="table table-hovered">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Year</th>
                    <th scope="col">Author</th>
                    <th scope="col">Author Type</th>
                    <th scope="col">Publication Weekday</th>
                    <th scope="col">Review Count</th>
                </tr>
            </thead>
            <tbody>
                <% result.forEach((record, index) => { %>
                    <tr>
                        <th scope="row"><%= record.year %></th>
                        <td><%= record.author %></td>
                        <td><%= record.author_type %></td>
                        <td><%= record.pub_weekday %></td>
                        <td><%= record.reviewCount %></td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
    <% } %>
    <script>
        $(document).ready(function(){
            $("#field1_2, #field1_3, #field2_2, #field2_3").attr("disabled", true);
            $("#field1_1, #field1_2, #field1_3")
                .children("option")
                .filter(":selected")
                .attr("selected", false)
            $(".placeholder1").attr("selected", true)
            $("#field2_1, #field2_2, #field2_3")
                .children("option")
                .filter(":selected")
                .attr("selected", false)
            $(".placeholder2").attr("selected", true)
        });

        function checkErr() {
            const field1_1 = $("#field1_1").val()
            const field1_2 = $("#field1_2").val()
            const field1_3 = $("#field1_3").val()
            const field2_1 = $("#field2_1").val()
            const field2_2 = $("#field2_2").val()
            const field2_3 = $("#field2_3").val()
            
            let dupe = 
                field1_1 === field1_2 || field1_1 === field1_3 || field1_2 === field1_3 ||
                field2_1 === field2_2 || field2_1 === field2_3 || field2_2 === field2_3

            let blank = 
                field1_1 === "blank1" || 
                field2_1 === "blank2" 

            if (dupe) {
                $("#dupe-error").attr("hidden", false)
            } else {
                $("#dupe-error").attr("hidden", true)
            }

            if (blank) {
                $("#blank-error").attr("hidden", false)
            } else {
                $("#blank-error").attr("hidden", true)
            }

            if (dupe || blank) {
                $("#submit").attr("disabled", true)
            } else {
                $("#submit").attr("disabled", false)
            }
        }

        $("#field1_1, #field1_2, #field1_3, #field2_1, #field2_2, #field2_3").on("change", function () {
            checkErr()
        })
        $("#field1_1").on("change", function () {
            if ($("#field1_1").val() === "blank1"){
                $("#field1_2").attr("disabled", true)
                $("#field1_2")
                    .children("option")
                    .filter(":selected")
                    .attr("selected", false)
                $(".placeholder1").attr("selected", true)
            }
            else{
                $("#field1_2").attr("disabled", false)
            }
        })
        $("#field1_2").on("change", function () {
            if ($("#field1_2").val() === "blank1_1"){
                $("#field1_3").attr("disabled", true)
                $("#field1_3")
                    .children("option")
                    .filter(":selected")
                    .attr("selected", false)
                $(".placeholder1").attr("selected", true)
            }
            else{
                $("#field1_3").attr("disabled", false)
            }
        })
        
        $("#field2_1").on("change", function () {
            if ($("#field2_1").val() === "blank2"){
                $("#field2_2").attr("disabled", true)
                $("#field2_2")
                    .children("option")
                    .filter(":selected")
                    .attr("selected", false)
                $(".placeholder2").attr("selected", true)
            }
            else{
                $("#field2_2").attr("disabled", false)
            }
        })

        $("#field2_2").on("change", function () {
            if ($("#field2_2").val() === "blank2_1"){
                $("#field2_3").attr("disabled", true)
                $("#field2_3")
                    .children("option")
                    .filter(":selected")
                    .attr("selected", false)
                $(".placeholder2").attr("selected", true)
            }
            else{
                $("#field2_3").attr("disabled", false)
            }
        })
    </script>
</body>
</html>